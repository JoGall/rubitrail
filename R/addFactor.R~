#' @include main.R
NULL
#' A general function to retrive raw data from a UbiTrail result file.
#'
#' This function will load a result file as a list of matrices, before smoothing and resampling to calcualte the distance between successive positions for each area matrix.
#' 
#' @param dat a list outputted by \code{\link{rubitMain}}.
#' @param new_factor the data to be used, with a factor corresponding to each unique 'id' in the data outputted by \code{\link{rubitMain}}.
#' @param new_factor_name the character name to be given to the new factor.
#' @note TODO
#' @return the inputted list with a new column appended to each element.
#' @examples
#' \dontrun{
#' data(tenebrio_processed)
#' ### view IDs and assign treatments
#' tenebrio_processed$id
#' treatments <- as.factor(c("LPS", "ctrl", "ctrl", "LPS", "LPS", "ctrl"))
#' tenebrio_processed <- add_new_factor(tenebrio_processed, treatments, "treat")
#' }
#' @note TODO
#' @seealso \code{\link{rubitMain}} which produces the list to be used by this function.
#' @export
rubitAddFactor <- function(dat, new_factor, new_factor_name) {
	
	for(i in attributes(dat)$names[1:3]) {
	
		#extend short vector of variables to fit full data
		rep_times <- rle(dat[[i]]$id)$lengths
		new_factor_full <- rep(new_factor, times=rep_times)

		#append to data
		dat[[i]]$temp <- new_factor_full
		colnames(dat[[i]])[colnames(dat[[i]]) == "temp"] <- new_factor_name
	}
	return(dat)
}